# 🚀 CI/CD Pipeline Documentation\n\nThis document describes the complete CI/CD pipeline setup for the Aspekt project, including build automation, testing, and package publishing.\n\n## 📋 Pipeline Overview\n\nThe Aspekt project uses GitHub Actions for continuous integration and deployment with the following workflows:\n\n### 🔧 Main CI/CD Workflow (`ci.yml`)\n\n**Triggered by:**\n- Push to `master`, `main`, or `develop` branches\n- Pull requests to `master` or `main`\n- Release publications\n\n**Jobs:**\n\n1. **Build & Test** - Multi-version testing across .NET 6.0, 8.0, and 9.0\n2. **Code Quality Analysis** - Code formatting and static analysis\n3. **Security Scan** - Vulnerability assessment\n4. **Publish to NuGet** - Release packages to NuGet.org (on releases)\n5. **Publish Pre-release** - Alpha packages to GitHub Packages (on master commits)\n\n### 📖 Documentation Workflow (`docs.yml`)\n\n**Triggered by:**\n- Changes to documentation files\n- Push to main branches\n\n**Features:**\n- Markdown link validation\n- Spell checking\n- Documentation structure validation\n- Automatic table of contents updates\n\n### 🏷️ Release Workflow (`release.yml`)\n\n**Triggered by:**\n- Git tags matching `v*.*.*` pattern\n\n**Creates:**\n- GitHub Releases with automated release notes\n- Attached NuGet packages\n- Pre-release detection for alpha/beta tags\n\n### 🤖 Dependabot Auto-merge (`dependabot-auto-merge.yml`)\n\n**Triggered by:**\n- Dependabot pull requests\n\n**Features:**\n- Automated testing of dependency updates\n- Auto-merge for passing dependency PRs\n\n## 🔑 Required Secrets\n\nThe following secrets must be configured in your GitHub repository:\n\n### Required Secrets\n\n| Secret Name | Description | Required For |\n|-------------|-------------|-------------|\n| `NUGET_API_KEY` | NuGet.org API key for package publishing | NuGet releases |\n| `GITHUB_TOKEN` | Automatically provided by GitHub | GitHub Packages, releases |\n\n### Setting Up Secrets\n\n1. **NuGet API Key:**\n   ```bash\n   # Go to https://www.nuget.org/account/apikeys\n   # Create a new API key with \"Push new packages and package versions\" scope\n   # Add to GitHub Secrets as NUGET_API_KEY\n   ```\n\n2. **GitHub Token:**\n   - Automatically provided by GitHub Actions\n   - No manual setup required\n\n## 📦 Package Publishing\n\n### Release Process\n\n1. **Create a Release Tag:**\n   ```bash\n   git tag v2.0.1\n   git push origin v2.0.1\n   ```\n\n2. **GitHub Actions will:**\n   - Build and test all projects\n   - Create NuGet packages\n   - Run security scans\n   - Publish to NuGet.org\n   - Publish to GitHub Packages\n   - Create GitHub Release with notes\n\n### Pre-release Process\n\nPush to `master` branch automatically:\n- Creates alpha packages with timestamp and commit SHA\n- Publishes to GitHub Packages only\n- Format: `2.0.0-alpha.20241026143022.abc1234.nupkg`\n\n### Manual Package Creation\n\n```bash\n# Build packages locally\ndotnet pack Aspekt/Aspekt.csproj --configuration Release --output nupkgs\ndotnet pack Aspekt.Contracts/Aspekt.Contracts.csproj --configuration Release --output nupkgs\ndotnet pack Aspekt.Logging/Aspekt.Logging.csproj --configuration Release --output nupkgs\n\n# Publish manually (if needed)\ndotnet nuget push \"nupkgs/*.nupkg\" --api-key YOUR_API_KEY --source https://api.nuget.org/v3/index.json\n```\n\n## 🛡️ Security & Quality\n\n### Code Analysis\n\n- **Roslyn Analyzers**: Enabled with `AllEnabledByDefault` mode\n- **StyleCop**: Code style enforcement\n- **Security Analysis**: Vulnerability scanning for dependencies\n- **Code Formatting**: Automatic verification with `dotnet format`\n\n### Dependency Management\n\n- **Dependabot**: Weekly automatic dependency updates\n- **Auto-merge**: Passing dependency updates are automatically merged\n- **Security Alerts**: Automated vulnerability detection\n\n## 🔄 Workflow Details\n\n### Build Matrix\n\n```yaml\nstrategy:\n  matrix:\n    dotnet-version: ['6.0.x', '8.0.x', '9.0.x']\n```\n\n- Tests run against all supported .NET versions\n- Only .NET 8.0 creates and uploads packages (single artifact)\n- Ensures compatibility across all target frameworks\n\n### Test Execution\n\n```yaml\n# Individual project testing for clear results\ndotnet test Aspekt.Test/Aspekt.Test.csproj\ndotnet test Aspekt.Bootstrap.Test/Aspekt.Bootstrap.Test.csproj\ndotnet test Aspekt.Foundation.Test/Aspekt.Foundation.Test.csproj\ndotnet test Aspekt.Logging.Test/Aspekt.Logging.Test.csproj\n```\n\n### Caching Strategy\n\n- **NuGet Packages**: Cached based on project files and lock files\n- **Build Artifacts**: Temporary caching for workflow efficiency\n- **Test Results**: Uploaded for all matrix combinations\n\n## 🎯 Package Information\n\n### Published Packages\n\n1. **Aspekt** - Core AOP functionality\n   - Target Frameworks: `net9.0;net8.0;net6.0;netstandard2.1`\n   - Dependencies: Minimal, self-contained\n\n2. **Aspekt.Contracts** - Design by Contract\n   - Target Frameworks: `net9.0;net8.0;net6.0;netstandard2.1`\n   - Dependencies: Aspekt (core)\n\n3. **Aspekt.Logging** - Logging Aspects\n   - Target Frameworks: `net9.0;net8.0;net6.0;netstandard2.1`\n   - Dependencies: Aspekt (core), Microsoft.Extensions.Logging\n\n### Package Metadata\n\n```xml\n<PropertyGroup>\n  <Authors>mvpete</Authors>\n  <Copyright>Peter Lorimer © 2025</Copyright>\n  <PackageLicenseExpression>MIT</PackageLicenseExpression>\n  <RepositoryUrl>https://github.com/mvpete/aspekt</RepositoryUrl>\n  <PackageTags>AOP;Aspect Oriented Programming</PackageTags>\n</PropertyGroup>\n```\n\n## 🚨 Troubleshooting\n\n### Common Issues\n\n**Build Failures:**\n```bash\n# Check workflow logs\n# Verify .NET SDK versions\n# Check for breaking changes in dependencies\n```\n\n**Test Failures:**\n```bash\n# Download test artifacts from failed runs\n# Check for timing issues in parallel tests\n# Verify static state cleanup between tests\n```\n\n**Publish Failures:**\n```bash\n# Verify API keys are current\n# Check package version conflicts\n# Ensure all required metadata is present\n```\n\n### Debug Commands\n\n```bash\n# Local build simulation\ndotnet restore Aspekt.sln\ndotnet build Aspekt.sln --configuration Release\ndotnet test --configuration Release --verbosity normal\n\n# Package creation\ndotnet pack --configuration Release --output nupkgs\n\n# Format checking\ndotnet format Aspekt.sln --verify-no-changes\n```\n\n## 📈 Monitoring\n\n### Workflow Status\n\n- **Build Status**: Visible in repository badges\n- **Test Results**: Uploaded as artifacts for each run\n- **Package Downloads**: Tracked via NuGet.org analytics\n- **Security Alerts**: GitHub Advanced Security (if enabled)\n\n### Metrics\n\n- **Build Time**: Typically 3-5 minutes for full matrix\n- **Test Coverage**: Tracked per project\n- **Package Size**: Monitored for bloat\n- **Dependency Updates**: Weekly automatic checks\n\n## 🔮 Future Enhancements\n\n### Planned Improvements\n\n- [ ] Integration testing with real applications\n- [ ] Performance benchmarking\n- [ ] Multi-platform testing (Linux, macOS)\n- [ ] Code coverage reporting\n- [ ] Automated changelog generation\n- [ ] Canary releases for early adopters\n\n### Advanced Features\n\n- [ ] Multi-stage deployments\n- [ ] Blue/green deployment strategy\n- [ ] Package signing with certificates\n- [ ] Automated rollback on critical issues\n- [ ] Integration with package vulnerability databases\n\n---\n\n## 📞 Support\n\nFor issues with the CI/CD pipeline:\n\n1. Check the [Troubleshooting Guide](../docs/TROUBLESHOOTING.md)\n2. Review workflow logs in GitHub Actions\n3. Create an issue using the bug report template\n4. Contact maintainers via GitHub discussions\n\n**Pipeline maintained by:** [@mvpete](https://github.com/mvpete)\n\n**Last updated:** October 2025